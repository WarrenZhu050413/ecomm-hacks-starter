<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ephemeral - Masonry Waterfall</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;500;600&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    /* CSS Variables */
    :root {
      --cream: #FAF8F3;
      --cream-dark: #F0EDE5;
      --sepia: #8b7355;
      --sepia-light: #a08b70;
      --pencil: #4a4a48;
      --pencil-light: #6a6a68;
      --shadow: rgba(74, 74, 72, 0.12);
      --shadow-strong: rgba(74, 74, 72, 0.2);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--cream);
      color: var(--pencil);
      overflow-x: hidden;
      scroll-behavior: smooth;
    }

    /* Paper texture overlay */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      opacity: 0.03;
      pointer-events: none;
      z-index: 0;
    }

    /* Header */
    header {
      position: sticky;
      top: 0;
      padding: 2rem 3rem;
      background: rgba(250, 248, 243, 0.92);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(139, 115, 85, 0.12);
      z-index: 100;
    }

    h1 {
      font-family: 'Crimson Pro', serif;
      font-size: 2.75rem;
      font-weight: 400;
      color: var(--sepia);
      letter-spacing: 0.03em;
      text-align: center;
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--sepia-light);
      text-align: center;
      margin-top: 0.5rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-weight: 500;
    }

    /* Masonry Container */
    .masonry-container {
      padding: 3rem 2rem;
      max-width: 1600px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .masonry-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 2rem;
      grid-auto-flow: dense;
    }

    @media (min-width: 768px) {
      .masonry-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 1200px) {
      .masonry-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    /* Product Card */
    .product-card {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 8px 32px var(--shadow);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0;
      transform: translateY(40px);
      cursor: pointer;
    }

    .product-card.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .product-card:hover {
      box-shadow: 0 16px 56px var(--shadow-strong);
      transform: translateY(-4px);
    }

    /* Placeholder Image */
    .product-image {
      width: 100%;
      height: auto;
      aspect-ratio: 3/4;
      background: linear-gradient(135deg, var(--sepia-light), var(--cream-dark));
      position: relative;
      overflow: hidden;
    }

    /* Vary heights for masonry effect */
    .product-card:nth-child(3n+1) .product-image {
      aspect-ratio: 4/5;
    }

    .product-card:nth-child(3n+2) .product-image {
      aspect-ratio: 3/4;
    }

    .product-card:nth-child(3n+3) .product-image {
      aspect-ratio: 2/3;
    }

    /* Decorative gradient overlay on placeholder */
    .product-image::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to bottom right,
        transparent 0%,
        rgba(139, 115, 85, 0.1) 50%,
        rgba(139, 115, 85, 0.2) 100%
      );
    }

    /* Product Info */
    .product-info {
      padding: 1.5rem;
      background: white;
    }

    .product-brand {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--sepia-light);
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .product-name {
      font-family: 'Crimson Pro', serif;
      font-size: 1.35rem;
      font-weight: 500;
      color: var(--pencil);
      margin-bottom: 0.75rem;
      line-height: 1.3;
    }

    .product-price {
      font-size: 1.1rem;
      color: var(--sepia);
      font-weight: 500;
    }

    /* Loading State */
    .loading {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--sepia-light);
      font-style: italic;
    }

    /* Staggered animation delays by column */
    @media (min-width: 768px) {
      .product-card:nth-child(3n+1).visible {
        animation: fadeInUp 0.6s ease-out;
        animation-delay: 0s;
      }

      .product-card:nth-child(3n+2).visible {
        animation: fadeInUp 0.6s ease-out;
        animation-delay: 0.1s;
      }

      .product-card:nth-child(3n+3).visible {
        animation: fadeInUp 0.6s ease-out;
        animation-delay: 0.2s;
      }
    }

    @media (min-width: 1200px) {
      .product-card:nth-child(4n+1).visible {
        animation: fadeInUp 0.6s ease-out;
        animation-delay: 0s;
      }

      .product-card:nth-child(4n+2).visible {
        animation: fadeInUp 0.6s ease-out;
        animation-delay: 0.1s;
      }

      .product-card:nth-child(4n+3).visible {
        animation: fadeInUp 0.6s ease-out;
        animation-delay: 0.15s;
      }

      .product-card:nth-child(4n+4).visible {
        animation: fadeInUp 0.6s ease-out;
        animation-delay: 0.2s;
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Ephemeral</h1>
    <div class="subtitle">Curated Luxury</div>
  </header>

  <div class="masonry-container">
    <div class="masonry-grid" id="productGrid">
      <div class="loading">Loading collection...</div>
    </div>
  </div>

  <script>
    // Fetch products from manifest
    async function loadProducts() {
      try {
        const response = await fetch('/gallery/manifest.json');
        const products = await response.json();
        renderProducts(products);
        observeCards();
      } catch (error) {
        console.error('Failed to load products:', error);
        document.getElementById('productGrid').innerHTML =
          '<div class="loading">Failed to load collection. Please refresh.</div>';
      }
    }

    // Generate hue for placeholder color based on product index
    function getPlaceholderGradient(index) {
      const hues = [30, 45, 25, 35, 40, 20, 38, 28, 42, 32, 36, 26, 34];
      const hue = hues[index % hues.length];
      const saturation = 15 + (index % 3) * 5;
      const lightness = 75 + (index % 4) * 3;

      return `linear-gradient(135deg,
        hsl(${hue}, ${saturation}%, ${lightness}%),
        hsl(${hue + 10}, ${saturation - 5}%, ${lightness - 10}%))`;
    }

    // Render product cards
    function renderProducts(products) {
      const grid = document.getElementById('productGrid');
      grid.innerHTML = '';

      products.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.dataset.index = index;

        const gradient = getPlaceholderGradient(index);

        card.innerHTML = `
          <div class="product-image" style="background: ${gradient}">
          </div>
          <div class="product-info">
            <div class="product-brand">${item.product.brand}</div>
            <div class="product-name">${item.product.name}</div>
            <div class="product-price">$${item.product.price.toLocaleString()}</div>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    // Intersection Observer for scroll-triggered animations
    function observeCards() {
      const options = {
        root: null,
        rootMargin: '0px 0px -100px 0px', // Trigger before fully in view
        threshold: 0.1
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target); // Only animate once
          }
        });
      }, options);

      const cards = document.querySelectorAll('.product-card');
      cards.forEach(card => observer.observe(card));
    }

    // Initialize
    loadProducts();
  </script>
</body>
</html>
